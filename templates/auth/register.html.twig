{% extends 'base.html.twig' %}

{% block title %}Inscription - {{ parent() }}{% endblock %}

{% block body %}
<div class="row justify-content-center">
    <div class="col-md-10 col-lg-8">
        <div class="card shadow-sm">
            <div class="card-body p-3">
                <header class="text-center mb-3">
                    <h1 class="h5 mb-2">Inscription</h1>
                    <div class="avatar-placeholder d-flex align-items-center justify-content-center mx-auto" style="width: 60px; height: 60px; background-color: #f8f9fa; border-radius: 50%; color: #6c757d;">
                        <i class="bi bi-person-plus" style="font-size: 2rem;"></i>
                    </div>
                </header>

                {% if errors is defined and errors|length > 0 %}
                    <div class="alert alert-danger">
                        <ul class="mb-0">
                            {% for error in errors %}
                                <li>{{ error }}</li>
                            {% endfor %}
                        </ul>
                    </div>
                {% endif %}

                {% for message in app.flashes('success') %}
                    <div class="alert alert-success">{{ message }}</div>
                {% endfor %}

                <form method="post" data-turbo="false" enctype="multipart/form-data">
                    <div class="row">
                        <div class="col-md-6 mb-2">
                            <label for="nom" class="form-label">Nom <span class="text-danger">*</span></label>
                            <input type="text" name="nom" id="nom" class="form-control form-control-sm"
                                   placeholder="Votre nom" maxlength="30"
                                   value="{{ formData.nom|default('') }}" required>
                        </div>
                        <div class="col-md-6 mb-2">
                            <label for="prenom" class="form-label">Prénom <span class="text-danger">*</span></label>
                            <input type="text" name="prenom" id="prenom" class="form-control form-control-sm"
                                   placeholder="Votre prénom" maxlength="30"
                                   value="{{ formData.prenom|default('') }}" required>
                        </div>
                    </div>

                    <div class="row">
                        <div class="col-md-6 mb-2">
                            <label for="pseudo" class="form-label">Pseudo <span class="text-danger">*</span></label>
                            <input type="text" name="pseudo" id="pseudo" class="form-control form-control-sm"
                                   autocomplete="username" placeholder="Votre pseudo" maxlength="30"
                                   value="{{ formData.pseudo|default('') }}" required autofocus>
                            <small class="form-text text-muted">Ce sera votre identifiant de connexion</small>
                        </div>
                        <div class="col-md-6 mb-2">
                            <label for="mail" class="form-label">Email <span class="text-danger">*</span></label>
                            <input type="email" name="mail" id="mail" class="form-control form-control-sm"
                                   autocomplete="email" placeholder="votre.email@exemple.fr" maxlength="255"
                                   value="{{ formData.mail|default('') }}" required>
                        </div>
                    </div>

                    <div class="row">
                        <div class="col-md-6 mb-2">
                            <label for="telephone" class="form-label">Téléphone</label>
                            <input type="tel" name="telephone" id="telephone" class="form-control form-control-sm"
                                   placeholder="06 12 34 56 78" maxlength="15"
                                   value="{{ formData.telephone|default('') }}">
                            <small class="form-text text-muted">Optionnel</small>
                        </div>
                        <div class="col-md-6 mb-2">
                            <label for="site_id" class="form-label">Site <span class="text-danger">*</span></label>
                            <select name="site_id" id="site_id" class="form-select form-select-sm" required>
                                <option value="">Choisissez votre site</option>
                                {% for site in sites %}
                                    <option value="{{ site.id }}"
                                            {% if formData.site_id|default('') == site.id %}selected{% endif %}>
                                        {{ site.nomSite }}
                                    </option>
                                {% endfor %}
                            </select>
                        </div>
                    </div>

                    <div class="row">
                        <div class="col-md-6 mb-2">
                            <label for="password" class="form-label">Mot de passe <span class="text-danger">*</span></label>
                            <input type="password" name="password" id="password" class="form-control form-control-sm"
                                   autocomplete="new-password" placeholder="Votre mot de passe" required>
                        </div>
                        <div class="col-md-6 mb-2">
                            <label for="password_confirm" class="form-label">Confirmer <span class="text-danger">*</span></label>
                            <input type="password" name="password_confirm" id="password_confirm"
                                   class="form-control form-control-sm" autocomplete="new-password"
                                   placeholder="Confirmer le mot de passe" required>
                        </div>
                    </div>

                    <div class="mb-3">
                        <label for="photo_profil" class="form-label">Photo de profil</label>
                        <input type="file" name="photo_profil" id="photo_profil" class="form-control form-control-sm" accept="image/jpeg,image/jpg,image/png,image/webp">
                        <small class="form-text text-muted">Optionnel - JPG, PNG ou WebP (max 2MB)</small>
                        <div id="photo-preview" class="mt-2" style="display: none;">
                            <img id="photo-preview-img" src="" alt="Aperçu" class="img-thumbnail" style="max-width: 100px; max-height: 100px;">
                        </div>
                    </div>

                    <input type="hidden" name="_csrf_token" value="{{ csrf_token('register') }}">

                    <div class="text-center my-3">
                        <button type="submit" class="btn btn-primary" style="width: 50%;">Créer mon compte</button>
                    </div>
                </form>

                <hr class="my-3">
                <div class="text-center">
                    <small class="text-muted d-block mb-1">Déjà un compte ?</small>
                    <a href="{{ path('app_login') }}" class="btn btn-outline-primary btn-sm">Se connecter</a>
                </div>
                </div>
            </div>
        </div>
    </div>
{% endblock %}

{% block stylesheets %}
    <link rel="stylesheet" href="{{ asset('css/auth.css') }}">
{% endblock %}

{% block javascripts %}
    {{ parent() }}
    <script>
        document.getElementById('photo_profil').addEventListener('change', function(e) {
            const file = e.target.files[0];
            const preview = document.getElementById('photo-preview');
            const previewImg = document.getElementById('photo-preview-img');

            if (file) {
                const reader = new FileReader();
                reader.onload = function(e) {
                    previewImg.src = e.target.result;
                    preview.style.display = 'block';
                };
                reader.readAsDataURL(file);
            } else {
                preview.style.display = 'none';
            }
        });
    </script>
{% endblock %}
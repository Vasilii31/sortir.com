{% extends 'base.html.twig' %}

{% block title %}New Sortie{% endblock %}

{% block body %}
    <h4 class="txt-custom-prim my-3">Créer une nouvelle sortie</h4>
    <div class="card my-3 p-4 shadow-sm">
        {{ form_start(form) }}

        <div class="row">
            <div class="col-md-6">
                {{ form_row(form.nom) }}
            </div>
            <div class="col-md-6">
                {{ form_row(form.nbInscriptionsMax) }}
            </div>
        </div>

        <div class="row">
            <div class="col-md-6">
                {{ form_row(form.datedebut) }}
            </div>
            <div class="col-md-6">
                {{ form_row(form.datecloture) }}
            </div>
        </div>

        <div class="row">
            <div class="col-md-6">
                {{ form_row(form.duree) }}
            </div>
            <div class="col-md-6">
                {{ form_row(form.descriptionInfos) }}
            </div>
        </div>

        <div class="row">
            <div class="col-md-6">
                {{ form_row(form.ville) }}
            </div>
            <div class="col-md-6">
                {{ form_row(form.lieu) }}
            </div>
        </div>

        <div id="lieu-details" class="mt-3">
            <p><strong>Rue :</strong> <span id="rue-display"></span></p>
            <p><strong>Code postal :</strong> <span id="ville-cp"></span></p>
            <p><strong>Latitude :</strong> <span id="latitude"></span></p>
            <p><strong>Longitude :</strong> <span id="longitude"></span></p>
        </div>

        <div class="d-flex justify-content-center gap-3 mt-4">
            {{ form_widget(form.enregistrer, {'attr': {'class': 'a-custom-sec'}}) }}
            {{ form_widget(form.publier, {'attr': {'class': 'a-custom-prim'}}) }}
            <a href="{{ path('app_sortie_index') }}" class="a-custom-warn">Annuler</a>
        </div>

        {{ form_end(form) }}
    </div>

        <script>
            document.addEventListener('DOMContentLoaded', function () {
                const selectVille = document.getElementById('{{ form.ville.vars.id }}');
                const selectLieu  = document.getElementById('{{ form.lieu.vars.id }}');
                const spanRue     = document.getElementById('rue-display');
                const spanCp      = document.getElementById('ville-cp');
                const spanLatitude = document.getElementById('latitude');
                const spanLongitude = document.getElementById('longitude');
                const divDetails  = document.getElementById('lieu-details');

                const allOptions = Array.from(selectLieu.options);

                // Désactiver le select Lieu au départ si aucune ville sélectionnée
                selectLieu.disabled = !selectVille.value;

                function updateLieuOptions() {
                    const villeId = selectVille.value;

                    selectLieu.innerHTML = '';
                    selectLieu.appendChild(new Option('Choisissez un lieu', ''));

                    if (!villeId) {
                        selectLieu.disabled = true; // désactivé si pas de ville
                        updateLieuDetails();
                        return;
                    }

                    selectLieu.disabled = false; // activer le select
                    allOptions.forEach(opt => {
                        if (opt.dataset.villeId === villeId) {
                            selectLieu.appendChild(opt);
                        }
                    });

                    updateLieuDetails();
                }

                function updateLieuDetails() {
                    const opt = selectLieu.options[selectLieu.selectedIndex];
                    if (!opt) return;

                    spanRue.textContent   = opt.dataset.rue || '';
                    spanCp.textContent    = opt.dataset.cp || '';
                    spanLatitude.textContent = opt.dataset.latitude || '';
                    spanLongitude.textContent = opt.dataset.longitude || '';
                    // divDetails.style.display = spanRue.textContent ? 'block' : 'none';
                }

                selectVille.addEventListener('change', updateLieuOptions);
                selectLieu.addEventListener('change', updateLieuDetails);

                // initialisation
                updateLieuOptions();
            });



        </script>

        {% endblock %}



